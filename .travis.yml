dist: bionic
language: python

jobs:
  include:
    # Django 2.2: Python 3.6, 3.7 or 3.8
    - { env: TOXENV=py36-django22, python: 3.6 }
    - { env: TOXENV=py37-django22, python: 3.7 }
    - { env: TOXENV=py38-django22, python: 3.8 }
    # Django 3.1: Python 3.7, 3.8 or 3.9
    - { env: TOXENV=py37-django31, python: 3.7 }
    - { env: TOXENV=py38-django31, python: 3.8 }
    - { env: TOXENV=py39-django31, python: 3.9 }
    # Lint: Python 3.6
    - { env: TOXENV=linters, python: 3.6 }
    # Test docs
    - { env: TOXENV=docs, python: 3.6 }

cache:
  directories:
    - $HOME/.cache/pip
    - $TRAVIS_BUILD_DIR/.tox

install:
  - pip install --upgrade pip wheel setuptools
  - pip install codecov coverage tox

script:
  - tox

after_success:
  - coverage xml -i
  - codecov

deploy:
  provider: pypi
  username: erdnaxe
  edge: true # opt in to dpl v2
  on:
    tags: true
